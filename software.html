<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relatify - Software</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2&display=swap" rel="stylesheet">
<style>
body { font-family: 'Baloo Bhai 2', Comic Sans MS, sans-serif; background:#121212; color:#fff; text-align:center; margin:0; padding:0; }
header { background:#1A237E; padding:20px; font-size:2rem; font-weight:bold; color:#fff; position: sticky; top: 0; z-index: 1000; display:flex; justify-content:space-between; align-items:center; }
main { padding:15px; display:flex; flex-direction:column; align-items:center; }
h2 { color:#FFD600; font-size:1.8rem; margin-bottom:15px; }

/* Search bar */
.search-box { width:100%; display:flex; justify-content:center; position: sticky; top:60px; background:#121212; padding:8px 0; z-index:999; }
.search-box input { padding:10px 12px; border-radius:10px; border:none; width:90%; max-width:320px; font-size:1rem; background:#fff; color:#000; box-shadow:0 2px 5px rgba(0,0,0,0.3); }
.search-box input::placeholder { color:#888; }
/* Autocomplete dropdown */
.autocomplete-items { position:absolute; background:#1E1E1E; border:1px solid #333; z-index:1002; width:90%; max-width:320px; margin-top:0; border-radius:5px; overflow:hidden; }
.autocomplete-item { padding:10px; cursor:pointer; color:#fff; text-align:left; border-bottom:1px solid #333; }
.autocomplete-item:hover { background:#00BFA5; }

/* Menu button */
.menu-btn { font-size:1.5rem; cursor:pointer; user-select:none; }
/* Side menu */
.side-menu { position: fixed; top:0; left:-250px; width:250px; height:100%; background:#1E1E1E; color:#fff; padding-top:60px; transition:0.3s; z-index:1001; display:flex; flex-direction:column; }
.side-menu button { background:none; color:#fff; border:none; padding:15px 20px; text-align:left; font-size:1rem; cursor:pointer; border-bottom:1px solid #333; }
.side-menu button:hover { background:#00BFA5; }

/* Grid */
.grid-container { width:100%; max-width:1000px; margin-top:15px; position:relative; }
.grid { display: grid; grid-template-columns: repeat(3, 1fr); gap:20px; justify-items:center; }
.card { background:#1E1E1E; padding:15px; border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,0.5); width:100%; max-width:250px; text-align:center; opacity:0; transform: translateY(15px); transition: opacity 0.3s ease, transform 0.3s ease; }
.card.visible { opacity:1; transform: translateY(0); }
.card img { width:100%; border-radius:10px; margin-bottom:12px; }
.card h3 { color:#00BFA5; font-size:1.2rem; margin-bottom:8px; }
.card p { font-size:0.9rem; color:#ccc; margin-bottom:12px; }
.card a { background:#00BFA5; color:#fff; padding:8px 18px; border-radius:8px; text-decoration:none; font-size:0.95rem; display:inline-block; transition:background 0.3s; }
.card a:hover { background:#26A69A; }
mark { background: #FFD600; color:#000; padding:0 2px; border-radius:2px; }
.no-results { opacity:0; transition: opacity 0.3s ease; color:#FFD600; font-size:1.3rem; margin-top:15px; text-align:center; }
.no-results.visible { opacity:1; }
footer { margin-top:30px; padding:12px; background:#1A237E; color:#fff; font-size:0.9rem; }

@media(max-width:400px){
  header { font-size:1.6rem; padding:15px; }
  .search-box input { font-size:0.95rem; padding:8px 10px; }
  .card a { font-size:0.9rem; padding:6px 15px; }
}
</style>
</head>
<body>

<header>
  Relatify
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
</header>

<div class="side-menu" id="sideMenu"></div>

<main>
  <h2>ðŸ’» Softwares</h2>

  <div class="search-box" style="position:relative;">
    <input type="text" id="searchInput" placeholder="Search for software..." autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
  </div>

  <div class="match-count" id="matchCount"></div>

  <div class="grid-container">
    <div class="grid" id="productGrid"></div>
    <div class="no-results" id="noResults">No products found</div>
  </div>
</main>

<footer>&copy; 2025 Relatify</footer>

<script>
// Silent redirect if not subscribed
if(sessionStorage.getItem('formSubmitted') !== 'true'){
    window.location.href = "index.html";
}

// Menu toggle
function toggleMenu() {
  const menu = document.getElementById('sideMenu');
  menu.style.left = menu.style.left === "0px" ? "-250px" : "0px";
}

const grid = document.getElementById('productGrid');
const noResults = document.getElementById('noResults');
const matchCount = document.getElementById('matchCount');
const searchInput = document.getElementById('searchInput');
const sideMenu = document.getElementById('sideMenu');
const autocompleteList = document.getElementById('autocomplete-list');

let products = [];
let categories = [];

// Fetch products and categories
async function loadData() {
  try {
    const resProducts = await fetch('products.json');
    products = await resProducts.json();

    const resCategories = await fetch('category.json');
    categories = await resCategories.json();

    renderMenuCategories();
    renderProducts(products, '');
  } catch (err) {
    console.error('Failed to load data', err);
    noResults.textContent = "Failed to load products";
    noResults.classList.add('visible');
  }
}

// Render categories in side menu
function renderMenuCategories() {
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.textContent = cat.name;
    btn.dataset.id = cat.id;
    btn.addEventListener('click', () => {
      renderProductsByCategory(cat.id);
      toggleMenu();
    });
    sideMenu.appendChild(btn);
  });
}

// Highlight search
function highlight(text, query) {
  if(!query) return text;
  const regex = new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
  return text.replace(regex, '<mark>$1</mark>');
}

// Render all products or search
function renderProducts(allProducts, query) {
  let filtered = allProducts;
  if(query) {
    filtered = filtered.filter(p => 
      p.name.toLowerCase().includes(query) || 
      p.description.toLowerCase().includes(query)
    );
  }
  displayProducts(filtered, query);
  renderAutocomplete(filtered, query);
}

// Render products by single category
function renderProductsByCategory(catId) {
  const cat = categories.find(c => c.id === catId);
  if(!cat) return displayProducts([], '');
  const filtered = products.filter(p => cat.products.includes(p.name));
  displayProducts(filtered, '');
}

// Display product cards
function displayProducts(filtered, query) {
  grid.innerHTML = '';
  if(filtered.length === 0) {
    noResults.classList.add('visible');
    matchCount.textContent = '';
    return;
  }
  noResults.classList.remove('visible');
  matchCount.textContent = `${filtered.length} product${filtered.length>1?'s':''} found`;

  filtered.forEach(product => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${product.img}" alt="${product.name}">
      <h3>${highlight(product.name, query)}</h3>
      <p>${highlight(product.description, query)}</p>
      <a href="${product.link}" target="_blank" rel="noopener noreferrer">Get Here</a>
    `;
    grid.appendChild(card);
    setTimeout(() => card.classList.add('visible'), 10);
  });
}

// Autocomplete dropdown
function renderAutocomplete(filtered, query) {
  autocompleteList.innerHTML = '';
  if(!query) return;
  filtered.forEach(product => {
    const div = document.createElement('div');
    div.className = 'autocomplete-item';
    div.innerHTML = highlight(product.name, query);
    div.addEventListener('click', () => {
      searchInput.value = product.name;
      renderProducts([product], product.name.toLowerCase());
      autocompleteList.innerHTML = '';
    });
    autocompleteList.appendChild(div);
  });
}

// Event listener for search
searchInput.addEventListener('input', () => {
  renderProducts(products, searchInput.value.toLowerCase());
});

// Close autocomplete if clicking outside
document.addEventListener('click', (e) => {
  if(e.target !== searchInput) autocompleteList.innerHTML = '';
});

// Initialize
loadData();
</script>

</body>
</html>
